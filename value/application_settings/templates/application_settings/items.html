{% extends 'application_settings/base.html' %}

{% load staticfiles customfields excelhelpers %}

{% block javascript %}
  <script src="{% static 'js/application_settings/settings.js' %}"></script>
  <script>
    $(function () {
      Sortable.create($("#column-display-order")[0], { 
        draggable: ".sortable",
        onEnd: function (evt) {
          var value = '';
          $("#column-display-order span").each(function () {
            value += $(this).attr("data-field-name") + ",";
            $(this).attr("data-field-order", $(this).index());
          });
          $("#id_column_display").val(value);
        }
      });
    });
  </script>
{% endblock javascript %}

{% block breadcrumb %}
  <ol class="breadcrumb">
    <li><a href="{% url 'home' %}">Home</a></li>
    <li><a href="{% url 'settings:index' %}">Application settings</a></li>
    <li class="active">Decision items</li>
  </ol>
{% endblock breadcrumb %}

{% block settings_content %}

  <form id="form_ordering" action="{% url 'settings:save_ordering' %}" method="post">
    {% csrf_token %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Decision items</h3>
      </div>
      <div class="panel-body">
        {% comment %}
        <div class="form-group" style="margin-bottom: 0">
          <label>Define the default ordering for every screen that display decision items</label>
          <div class="row">
            <div class="col-sm-6">
              <div class="panel panel-default">
                <div class="panel-heading">
                  Order by
                </div>
                <ul class="list-group sortable" style="min-height: 38px" id="order-by">
                  <li class="list-group-item">
                    <span class="pull-right">
                      <label class="radio-inline">
                        <input type="radio" name="name_order_criteria" value="asc" checked> <span class="fa fa-sort-alpha-asc"></span>
                      </label>
                      <label class="radio-inline">
                        <input type="radio" name="name_order_criteria" value="desc"> <span class="fa fa-sort-alpha-desc"></span>
                      </label>
                    </span>
                    Name
                  </li>
                </ul>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="panel panel-default" style="margin-bottom: 0">
                <div class="panel-heading">
                  Available columns
                </div>
                <ul class="list-group sortable" style="min-height: 38px" id="columns">
                  {% for name, field in custom_fields.items %}
                  <li class="list-group-item">
                    <span class="pull-right">
                      <label class="radio-inline">
                        <input type="radio" name="{{ name }}_order_criteria" value="asc" checked> {% custom_field_sort_icon field "asc" %}
                      </label>
                      <label class="radio-inline">
                        <input type="radio" name="{{ name }}_order_criteria" value="desc"> {% custom_field_sort_icon field "desc" %}
                      </label>
                    </span>
                    {{ field.label }}
                  </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          </div>
        </div>
        {% endcomment %}
        <div class="form-group" style="margin-bottom: 0">
          <label>Define the column display order</label>
          <input type="hidden" id="id_column_display" name="column_display" value="{{ app_settings.DECISION_ITEMS_COLUMNS_DISPLAY }}">
          <div id="column-display-order">
            {% spaceless %}
              {% for name, field in decision_items_fields.items %}
                <span class="label label-default sortable" data-field-name="{{ name }}" data-field-order="{{ forloop.counter0 }}">{{ field.label }}</span>
              {% endfor %}
            {% endspaceless %}
          </div>
        </div>
      </div>
      <div class="panel-footer">
        <button type="submit" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </form>

  <form id="form_custom_fields" method="post" action="{% url 'settings:save_custom_fields' %}">
    {% csrf_token %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Custom fields</h3>
      </div>
      <div class="panel-body" style="height: 400px; overflow-y: scroll;">
        <p>Add custom fields to the decision items model. Please note that the fields <strong>name</strong> and <strong>description</strong> are fixed.</p>
        <table class="table table-condensed table-bordered">
          <thead>
            <tr>
              <th>Column</th>
              <th>Label</th>
              <th>Data type</th>
              <th style="width: 60px;">Display</th>
              <th style="width: 60px;">Active</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="vertical-align: middle">name</td>
              <td><input type="text" class="form-control input-sm" disabled value="Name"></td>
              <td>
                <select class="form-control input-sm" disabled>
                  <option>String</option>
                </select>
              </td>
              <td style="vertical-align: middle; text-align: center;"><input type="checkbox" checked disabled></td>
              <td style="vertical-align: middle; text-align: center;"><input type="checkbox" checked disabled></td>
            </tr>
            <tr>
              <td style="vertical-align: middle;">description</td>
              <td><input type="text" class="form-control input-sm" disabled value="Description"></td>
              <td>
                <select class="form-control input-sm" disabled>
                  <option>String</option>
                </select>
              </td>
              <td style="vertical-align: middle; text-align: center;"><input type="checkbox" checked disabled></td>
              <td style="vertical-align: middle; text-align: center;"><input type="checkbox" checked disabled></td>
            </tr>
            {% for column_index in custom_fields_range %}
              <tr>
                <td style="vertical-align: middle">
                  column_{{ column_index }}
                </td>
                <td>
                  <input type="text" class="form-control input-sm js-control-disable" name="column_label_{{ column_index }}" maxlength="255" value="{% custom_field_attr custom_fields column_index 'label' %}">
                </td>
                <td>
                  <select class="form-control input-sm js-control-disable" name="column_type_{{ column_index }}">
                    {% for type in column_types %}
                      <option value="{{ type.0 }}" {% custom_field_selected custom_fields column_index type %}>{{ type.1 }}</option>
                    {% endfor %}
                  </select>
                </td>
                <td style="vertical-align: middle; text-align: center;">
                  <input type="checkbox" name="column_display_{{ column_index }}" class="js-control-disable" {% custom_field_display custom_fields column_index %}>
                </td>
                <td style="vertical-align: middle; text-align: center;">
                  <input type="checkbox" name="column_is_active_{{ column_index }}" {% custom_field_is_active custom_fields column_index %}>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="panel-footer">
        <button class="btn btn-primary" type="submit">Save changes</button>
      </div>
    </div>
  </form>
{% endblock settings_content %}
