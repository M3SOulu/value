{% extends 'base.html' %}

{% load staticfiles %}

{% block javascript %}
  <script src="{% static 'js/highcharts/highcharts.js' %}"></script>
  <script src="{% static 'js/highcharts/modules/treemap.js' %}"></script>
  <script src="{% static 'js/highcharts/modules/data.js' %}"></script>
  <script src="{% static 'js/highcharts/modules/drilldown.js' %}"></script>
  <script src="{% static 'js/workspace/analyze/analyze.js' %}"></script>
  <script>
    $(function () {

      $(".charts .panel-heading:eq(0)").loadchart();

    });
  </script>
{% endblock javascript %}

{% block breadcrumb %}
  <ol class="breadcrumb">
    <li><a href="{% url 'home' %}">Home</a></li>
    <li><a href="{% url 'workspace:index' %}">Workspace</a></li>
    <li><a href="{% url 'workspace:instance' instance.pk %}">{{ instance.name }}</a></li>
    <li><a href="{% url 'workspace:analyze:index' instance.pk %}">Analyze</a></li>
    <li class="active">{{ chart_page_title }}</li>
  </ol>
{% endblock breadcrumb %}

{% block content %}

  {% include 'workspace/includes/instance_menu.html' with active='analyze' instance=instance %}

  <div class="row">
    <div class="col-md-3">
      {% include 'workspace/analyze/includes/chart_menu.html' with active=chart_menu_active instance=instance %}
    </div>
    <div class="col-md-9">
      <div class="panel-group charts">
        {% for chart in charts %}
          <div class="panel panel-default panel-chart">
            <div class="panel-heading" data-target="#collapse-{{ chart.id }}" data-instance-id="{{ instance.id }}" data-item-id="{{ chart.id }}">

              <div class="btn-group btn-group-xs pull-right chart-options" role="group" aria-label="Chart Options">
                <button type="button" class="btn btn-default btn-xs btn-chart-toggle">
                  {% if forloop.first %}
                  <span class="glyphicon glyphicon-minus"></span>
                  {% else %}
                  <span class="glyphicon glyphicon-plus"></span>
                  {% endif %}
                </button>
                <button type="button" class="btn btn-default btn-xs btn-chart-expand"><span class="glyphicon glyphicon-new-window"></span></button>
                <button type="button" class="btn btn-default btn-xs btn-chart-reload"{% if not forloop.first %} disabled{% endif %}><span class="glyphicon glyphicon-refresh"></span></button>

                <div class="btn-group btn-group-xs" role="group">
                  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"{% if not forloop.first %} disabled{% endif %}>
                    <span class="fa fa-bar-chart"></span>
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-right js-chart-type" role="menu">
                    <li role="presentation" class="dropdown-header">Chart type</li>
                    <li role="presentation" class="active">
                      <a role="menuitem" tabindex="-1" href="javascript:void(0);" data-chart="bar"><span class="glyphicon glyphicon-align-left"></span> Stacked Bars</a>
                    </li>
                    <li role="presentation">
                      <a role="menuitem" tabindex="-1" href="javascript:void(0);" data-chart="column"><span class="glyphicon glyphicon-signal"></span> Stacked Columns</a>
                    </li>
                  </ul>
                </div>
              </div>

              <h4 class="panel-title" style="line-height: 1.4">
                <a href="javascript:void(0)" class="btn-chart-toggle">{{ chart.name }}</a>
              </h4>
            </div>
            <div id="collapse-{{ chart.id }}" class="panel-collapse collapse"{% if forloop.first %} style="display: block;"{% endif %}>
              <div class="panel-body" style="min-height: 400px"></div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="modal fade" id="expand-chart">
    <div class="modal-dialog" style="width: 95%">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title"></h4>
        </div>
        <div class="modal-body">
          <div id="modal-chart-container" style="min-height: 500px"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

{% endblock content %}
