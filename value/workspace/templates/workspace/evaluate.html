{% extends 'base.html' %}

{% load relative_col_size %}

{% block stylesheet %}
  <link href="{{ STATIC_URL }}css/workspace.instance.evaluate.css" rel="stylesheet">
{% endblock stylesheet %}

{% block javascript %}
  <script src="{{ STATIC_URL }}js/workspace.instance.evaluate.js"></script>
{% endblock javascript %}

{% block breadcrumb %}
  <ol class="breadcrumb">
    <li><a href="{% url 'home' %}">Home</a></li>
    <li><a href="{% url 'workspace:index' %}">Workspace</a></li>
    <li><a href="{% url 'workspace:instance' instance.pk %}">{{ instance.name }}</a></li>
    <li class="active">Evaluate</li>
  </ol>
{% endblock breadcrumb %}

{% block main %}

  {% include 'workspace/includes/instance_menu.html' with active='evaluate' instance=instance %}

  <div class="row">
    <div class="col-md-1">
      <strong>Workloud</strong>
    </div>
    <div class="col-md-11">
      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
          60%
        </div>
      </div>
    </div>
  </div>

  <div class="row" style="margin-bottom: 20px">
    <div class="col-md-12">
      <div class="dropdown pull-right">
        <button class="btn btn-default dropdown-toggle" type="button" id="filter" data-toggle="dropdown" aria-expanded="true">
          <span class="glyphicon glyphicon-eye-open"></span> View
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu" aria-labelledby="filter">
          <li role="presentation"><a role="menuitem" tabindex="-1" href="#"><span class="glyphicon glyphicon-check"></span> All</a></li>
          <li role="presentation"><a role="menuitem" tabindex="-1" href="#"><span class="glyphicon glyphicon-unchecked"></span> To-do</a></li>
          <li role="presentation"><a role="menuitem" tabindex="-1" href="#"><span class="glyphicon glyphicon-unchecked"></span> Finished</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      {% for item in instance.get_items %}
        <div class="panel panel-default">
          <div class="panel-heading">
            <span class="badge pull-right">0%</span>
            <!--span class="glyphicon glyphicon-ok pull-right"></span-->
            <h3 class="panel-title">{{ item.name }}</h3>
          </div>

          {% regroup user.profile.factors.all by measure as factors_grouped_by_measure %}

          {% if factors_grouped_by_measure|length > 1 %}
            <div class="panel-body">
          {% endif %}

          {% for factors_group in factors_grouped_by_measure %}
            <table class="table">
              <thead>
                <tr>
                  <th style="width: 25%">Value Factors</th>
                  {% with factors_group.list|first as first_factor %}
                    {% for measure in first_factor.measure.get_values %}
                      <th class="text-center" style="width: {{ first_factor.measure.get_values|relative_col_size }}">{{ measure.description }}</th>
                    {% endfor %}
                  {% endwith %}
                </tr>
              </thead>
              <tbody>
                {% for factor in factors_group.list %}
                  <tr>
                    <td>{{ factor }}</td>
                    {% for measure in factor.measure.get_values %}
                      <td class="text-center evaluable" 
                          data-color="{{ measure.color }}"
                          data-instance-id="{{ instance.pk }}"
                          data-factor-id="{{ factor.pk }}"
                          data-measure-id="{{ measure.measure.pk }}"
                          data-measure-value-id="{{ measure.pk }}">
                        <span class="glyphicon glyphicon-unchecked"></span>
                      </td>
                    {% endfor %}
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% endfor %}

          {% if factors_grouped_by_measure|length > 1 %}
            </div>
          {% endif %}

        </div>
      {% endfor %}
    </div>
  </div>

{% endblock main %}
