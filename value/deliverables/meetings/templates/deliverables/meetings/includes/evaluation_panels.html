{% load evaluation_percent evaluation_options %}

<form method="post" action="{% url 'deliverables:meetings:save_evaluation' meeting.deliverable.pk meeting.pk %}">
  {% csrf_token %}
  <input type="hidden" id="save-rationale-url" value="{% url 'deliverables:meetings:save_rationale' meeting.deliverable.pk meeting.pk %}">
  {% for meeting_item in meeting_items %}
    <div class="panel panel-default">
      <div class="panel-heading" data-target="#collapse-{{ meeting_item.pk }}">
        <table style="width: 100%">
          <body>
            <tr>
              <td style="width: 30%">
                <p class="panel-title">
                  <a href="javascript:void(0);" class="btn-toggle">{{ meeting_item.decision_item.name }}</a>
                  <span data-toggle="tooltip" title="Click to view details" data-container="body">
                    <a href="javascript:void(0);" class="btn-details js-decision-item-details" data-remote-url="{% url 'deliverables:details_decision_item' meeting.deliverable.pk meeting_item.decision_item.pk %}">
                      <span class="glyphicon glyphicon-info-sign"></span>
                    </a>
                  </span>
                </p>
              </td>
              <td>
                <div class="progress" style="margin-bottom: 0">
                  {% for measure_value in measure_values %}
                    <div class="progress-bar" style="width: {% evaluation_percent evaluations=evaluations meeting_item=meeting_item factors=factors measure_value=measure_value %}%; background-color: {{ measure_value.color }}">
                      <span class="measure-percent" data-measure-id="{{ measure_value.pk }}">{% evaluation_percent evaluations=evaluations meeting_item=meeting_item factors=factors measure_value=measure_value %}</span>%
                    </div>
                  {% endfor %}
                </div>
              </td>
            </tr>
          </body>
        </table>
      </div>
      <div id="collapse-{{ meeting_item.pk }}" class="panel-collapse collapse"{% if forloop.first %} style="display: block;"{% endif %}>
        <table class="table table-hover table-evaluate" data-meeting-item-id="{{ meeting_item.pk }}">
          <thead>
            <tr>
              <th style="width: 10%">Group</th>
              <th style="width: 20%">Factor</th>
              {% for measure_value in measure_values %}
                <th class="text-center" style="width: {{ relative_col_size }}">{{ measure_value.description }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% regroup factors by group as group_list %}

            {% for group in group_list %}
              {% for factor in group.list %}
                {% evaluation_options evaluations=evaluations meeting_item=meeting_item factor=factor measure_values=measure_values counter=forloop.counter rowspan=group.list|length %}
              {% endfor %}
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% endfor %}
</form>