{% extends 'base.html' %}

{% load avatar attr fieldtype %}

{% block javascript %}
<script type="text/javascript">
  if ($(".table-sortable").hasClass(".table-check-all")) {
    $(".table-sortable").tablesorter({ headers: { 0: { sorter: false }}});
  }
  else {
    $(".table-sortable").tablesorter();
  }
</script>
{% endblock javascript %}

{% block breadcrumb %}
  <ol class="breadcrumb">
    <li><a href="{% url 'home' %}">Home</a></li>
    <li><a href="{% url 'deliverables:index' %}">Deliverables</a></li>
    <li><a href="{% url 'deliverables:deliverable' meeting.deliverable.pk %}">{{ meeting.deliverable.name }}</a></li>
    <li class="active">{{ meeting.name }}</li>
  </ol>
{% endblock breadcrumb %}

{% block content %}

  {% include 'deliverables/meetings/includes/menu.html' with meeting=meeting active='meeting_summary' %}  

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Details</h3>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-sm-6">
            <h3 style="margin-top: 0">{{ meeting.name }}</h3>
          </div>
          <div class="col-sm-6 text-right">
            {% if not meeting.is_closed %}
            <form method="post" action="{% url 'deliverables:meetings:close_meeting' meeting.deliverable.pk meeting.pk %}">
              {% csrf_token %}
              <a href="#" class="btn btn-default"><span class="glyphicon glyphicon-pencil"></span> Edit</a>
              <button type="submit" class="btn btn-danger"><span class="glyphicon glyphicon-ban-circle"></span> Close</button>
            </form>
            {% endif %}
          </div>
        </div>
      </div>
        {% with progress=meeting.get_progress %}
          <div class="progress" style="margin-bottom: 0; border-top-left-radius: 0; border-top-right-radius: 0;">
            <div class="progress-bar{% if progress == 100.0 %} progress-bar-success{% else %} progress-bar-warning{% endif %}" role="progressbar" aria-valuenow="{{ progress }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ progress }}%;">
              {{ progress }}%
            </div>
          </div>
        {% endwith %}
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Stakeholders</h3>
      </div>
      <div class="panel-body">
        {% if meeting.is_closed %}
          {% include 'includes/users_panel_group.html' with stakeholders=stakeholders %}
        {% else %}
          <div class="alert alert-info alert-dismissible fade in" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            Click to remove a stakeholder from the meeting.
          </div>
          {% include 'includes/users_panel_group.html' with stakeholders=stakeholders group_actions='removeable' %}
        {% endif %}
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Meeting decision items</h3>
      </div>
      <div class="panel-body">

        {% if not meeting.is_closed %}
        <div class="btn-group" style="margin-bottom: 20px;">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
            Actions <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu">
            <li><a href="javascript:void(0);" class="js-remove-selected">Remove selected items</a></li>
          </ul>
        </div>
        {% endif %}
      
        {% with fields=meeting.deliverable.get_decision_items_fields %}
          <table class="table table-striped{% if not meeting.is_closed %} table-check-all{% endif %} table-sortable table-bordered" style="margin-bottom: 0;">
            <thead>
              <tr>
                {% if not meeting.is_closed %}
                <th><input type="checkbox"></th>
                {% endif %}
                {% for name, field in fields.items %}
                <th>{{ field.label }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for item in meeting.meetingitem_set.all %}
              <tr data-edit-url="">
                {% if not meeting.is_closed %}
                <td><input type="checkbox"></td>
                {% endif %}
                {% for name, field in fields.items %}
                  <td>{{ item.decision_item|attr:name }}</td>
                {% endfor %}
              </tr>
              {% empty %}
                <tr>
                  <td colspan="4">No data</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endwith %}

      </div>
    </div>

{% endblock content %}
